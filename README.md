# Учебное пособие по лучевой диагностике рака прямой кишки

## Описание проекта

Учебное пособие по лучевой диагностике рака прямой кишки, написанное с использованием фреймворка Quarto. Содержит систематизированную информацию о диагностике, стадировании и методах исследования рака прямой кишки с обширной визуализацией и научными ссылками.

## Структура проекта

```
RectumRadioBook/
├── README.md                         # Данный файл
├── CLAUDE.md                        # Инструкции для AI-редактирования
├── _quarto.yml                      # Конфигурация Quarto
├── index.qmd                        # Главная страница
├── references.bib                   # Библиография в BibTeX формате
├── .claude/                         # Конфигурации AI-агентов
│   └── agents/                      # Специализированные агенты
├── scripts/                         # Скрипты автоматизации
│   ├── prepare_images_prerender.py # Обработка изображений перед сборкой
│   ├── clean_generated_images.py   # Очистка временных файлов
│   ├── extract_comments.py         # Извлечение комментариев
│   └── setup_crossref.py           # Настройка перекрестных ссылок
├── styles/                          # Стили оформления
│   └── annotation.css              # CSS для аннотаций изображений
├── img/                            # Изображения и аннотации
│   ├── anatomy/                   # Анатомические иллюстрации
│   ├── classification/            # Классификация опухолей
│   ├── methodology/               # Методики исследования  
│   ├── staging/                   # Стадирование рака
│   │   ├── crm/                  # Циркулярный край резекции
│   │   ├── emvi/                 # Экстрамуральная венозная инвазия
│   │   ├── measurement/          # Измерения
│   │   └── t-staging/            # T-стадирование
│   ├── tumor-detection/          # Выявление опухолей
│   └── scheme/                   # Схемы и диаграммы
└── src/                           # Исходные файлы книги (.qmd)
    ├── Introduction.qmd           # Введение
    ├── Rectum-Anatomy.qmd        # Анатомия прямой кишки
    ├── Scan-Methodology.qmd      # Методика сканирования
    ├── Tumor-Detection.qmd       # Выявление опухоли
    │   ├── Classification.qmd   # Классификация
    │   ├── MRI-Detection.qmd    # МРТ диагностика
    │   └── CT-Detection.qmd     # КТ диагностика
    ├── Rectal-Cancer-Staging.qmd # Стадирование
    │   ├── T-Staging.qmd        # T-стадирование
    │   ├── N-Staging.qmd        # N-стадирование
    │   ├── Local-Extent-Assessment.qmd
    │   ├── Circumferential-Resection-Margin-Assessment.qmd
    │   └── Extramural-Venous-Invasion-Assessment.qmd
    ├── Structured-Report-Primary-MRI-Staging.qmd
    ├── Abbrevations.qmd          # Сокращения
    └── Bibliography.qmd          # Библиография
```

## Содержание книги

### 1. Введение
Основы понимания рака прямой кишки, эпидемиология и общие принципы диагностики.

### 2. Анатомия прямой кишки
- **Строение стенки** - детальное описание слоев стенки кишки
- **Отношение к брюшине** - анатомические особенности расположения
- **Мезоректальная фасция** - важные анатомические структуры для стадирования

### 3. Методика сканирования
Протоколы МРТ и КТ исследований, позиционирование пациента, параметры сканирования.

### 4. Выявление опухоли
- **Классификация** - типы опухолей и их характеристики
- **МРТ диагностика** - особенности визуализации на МРТ
- **КТ диагностика** - возможности КТ в выявлении опухолей

### 5. Стадирование рака прямой кишки
- **Т-стадирование** - оценка глубины инвазии опухоли
- **N-стадирование** - оценка поражения лимфатических узлов
- **Оценка местной распространенности** - локальная инвазия
- **Оценка циркулярного края резекции** - важный прогностический фактор
- **Оценка экстрамуральной венозной инвазии** - сосудистая инвазия

### 6. Структурированный отчет при первичном МРТ-стадировании РПК
Стандартизированный подход к описанию результатов МРТ-исследований.

### 7. Список литературы
Библиографические ссылки в формате CSL JSON.

## Технические особенности

### Фреймворк
Проект использует **Quarto** - современную систему научных публикаций, поддерживающую:
- Markdown с расширенным синтаксисом
- Перекрестные ссылки и цитирование
- Интерактивные элементы
- Множественные форматы вывода (HTML, PDF, Word)

### Инструменты автоматизации
- **prepare_images_prerender.py** - автоматическая обработка и стилизация SVG аннотаций
- **clean_generated_images.py** - очистка временных файлов после сборки
- **extract_comments.py** - извлечение комментариев для ревью
- **setup_crossref.py** - настройка перекрестных ссылок
- **CLAUDE.md** - инструкции для AI-ассистированного редактирования

### Workflow для изображений

Проект использует автоматизированную систему обработки аннотированных изображений на основе SVG файлов с применением CSS стилей.

#### Структура изображений
```
img/
├── anatomy/           # Анатомические иллюстрации
├── classification/    # Классификация опухолей  
├── methodology/       # Методики исследования
├── staging/          # Стадирование рака
│   ├── crm/          # Циркулярный край резекции
│   ├── emvi/         # Экстрамуральная венозная инвазия
│   ├── measurement/  # Измерения
│   └── t-staging/    # T-стадирование
├── tumor-detection/  # Выявление опухолей на МРТ/КТ
└── scheme/          # Схемы и диаграммы
```

#### Процесс обработки изображений

1. **Исходные файлы**: В каждой папке находятся:
   - Оригинальные изображения (`.png`, `.jpg`)
   - SVG файлы с векторными аннотациями (`annotation.svg`, `annotation_mri.svg`, `annotation_ct.svg`)

2. **Соглашения по именованию на разных стадиях обработки**:
   - **Исходные файлы**: `image1.png`
   - **Аннотированные SVG**: `annotation.svg` (без постфиксов)
   - **Стилизованные SVG**: `annotation_styled.svg` (постфикс `styled`) временный файл
   - **Финальные PNG**: `annotation_styled_annotated.png` (суффикс `annotated`) временный файл
   - **PNG из pre-render**: `_book/img/folder/annotation_styled_annotated.png` временный файл
   - **Аннотированные изображения**: `image1_annotated.png`

3. **Применение стилей**: CSS стили из `styles/annotation.css` автоматически применяются к SVG элементам на основе их слоев (layer names):
   - Анатомические слои: `mucosa`, `submucosa`, `muscularis`, `serosa`
   - Опухолевые структуры: `tumor`, `tumor_core`, `tumor_part`
   - Лимфатическая система: `lymph_node`, `lymph_node_necrosis`
   - Сосуды: `vessels`
   - Анатомические ориентиры: `dentate_line`, `sphincter`, `peritoneum`

4. **Автоматическая генерация**: При сборке книги через Quarto:
   - **Pre-render** (`scripts/prepare_images_prerender.py`):
     - Находит все SVG файлы с аннотациями по паттернам: `annotation.svg`, `annotation_mri.svg`, `annotation_ct.svg`, `annotatiom_mri.svg`
     - Применяет CSS стили к векторным элементам
     - Экспортирует стилизованные SVG в PNG через Inkscape
     - Копирует все изображения в директорию `_book/img/`
   - **Post-render** (`scripts/clean_generated_images.py`):
     - Удаляет временные файлы из исходных директорий
     - Оставляет только оригинальные файлы

5. **Ручная обработка** (опционально):
   ```bash
   python scripts/prepare_images.py --style annotation.css --folder ./img
   ```
   Этот скрипт может быть использован для:
   - Применения стилей к отдельным SVG файлам
   - Экспорта отдельных элементов из SVG по ID
   - Генерации изображений с контекстом и без

#### Требования
- **Inkscape** - должен быть установлен в системе для экспорта SVG в PNG
- **Python библиотеки**: lxml, pathlib

### Сборка книги

#### Быстрая сборка (HTML)
```bash
quarto render
```

#### Полная сборка (все форматы)
```bash
quarto render --profile full
```

#### Предварительный просмотр с автообновлением
```bash
quarto preview
```

### Стиль оформления
- Академический стиль с медицинской терминологией
- Все утверждения подкреплены научными ссылками
- Формат цитирования: [@authorShorttitleYear]
- Единая система сокращений (см. Abbrevations.qmd)
- Стандартизированные подписи к рисункам

## Рекомендации по навигации

1. **Начните с введения** для понимания общих принципов
2. **Изучите анатомию** для понимания структурных основ
3. **Ознакомьтесь с методикой исследования** для практического применения
4. **Последовательно изучите разделы по стадированию** для систематического понимания
5. **Используйте структурированный отчет** как практический инструмент

## Для редакторов и контрибьюторов

### Основные принципы
При работе с текстом следуйте инструкциям в файле `CLAUDE.md`, которые обеспечивают:
- Единообразный академический стиль
- Корректное оформление ссылок
- Сохранение медицинской точности
- Логическую структуру изложения

### Работа с изображениями
1. Оригинальные изображения помещайте в соответствующую папку в `img/`
2. Для аннотаций создавайте SVG файлы с именем `annotation.svg`
3. Используйте стандартные имена слоев для автоматической стилизации
4. Запускайте `quarto render` для автоматической обработки

### Работа с литературой
1. Все источники должны быть добавлены в Zotero
2. Экспортируйте в формате Better BibTeX в `references.bib`
3. Используйте стандартный формат цитирования
4. Проверяйте актуальность ссылок

### AI-ассистированное редактирование
Проект поддерживает работу с Claude AI через специализированных агентов:
- **medical-writer** - редактирование медицинских текстов
- **zotero-research-agent** - поиск литературы
- **python-developer** - автоматизация задач

## Лицензия и авторство
[Добавить информацию о лицензии]

## Контакты
[Добавить контактную информацию]